# å·¥å‚å®šé¢å’Œè®¡ä»¶å·¥èµ„ç®¡ç†ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

å·¥å‚å®šé¢å’Œè®¡ä»¶å·¥èµ„ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªç”¨äºå·¥å‚ç®¡ç†å·¥åºå®šé¢å’Œå·¥äººè®¡ä»¶å·¥èµ„çš„Webåº”ç”¨ã€‚è¯¥ç³»ç»Ÿæ”¯æŒå·¥åºç®¡ç†ã€å®šé¢è®¾ç½®ã€å·¥äººä¿¡æ¯ç®¡ç†ã€å·¥èµ„è®°å½•ä»¥åŠæŠ¥è¡¨ç»Ÿè®¡ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©å·¥å‚å®ç°è‡ªåŠ¨åŒ–çš„å·¥èµ„è®¡ç®—å’Œç®¡ç†ã€‚

## æœ€è¿‘æ›´æ–° (2026-02-26)

### TypeScriptè¿ç§»ä¸å‰ç«¯ä¼˜åŒ– (2025-12-24) - éƒ¨åˆ†è¿›åº¦æ›´æ–°
1. **TypeScriptè¿ç§»è¿›å±•**ï¼šå‰ç«¯æ ¸å¿ƒåŸºç¡€è®¾æ–½å·²è¿ç§»åˆ°TypeScript
1. **æ–°å¢ `obsolete_date` å­—æ®µ**ï¼šåœ¨å®šé¢è¡¨ (`quotas`) ä¸­æ–°å¢ä½œåºŸæ—¥æœŸå­—æ®µ
   - é»˜è®¤å€¼ï¼š`9999-12-31`ï¼Œè¡¨ç¤ºå½“å‰æœ‰æ•ˆçš„å®šé¢
   - æ•°æ®åº“è¿ç§»è„šæœ¬è‡ªåŠ¨ä¸ºç°æœ‰è®°å½•æ·»åŠ è¯¥å­—æ®µ
   - æ›´æ–°æ•°æ®åº“ç»“æ„æ–‡æ¡£ (`document/DATABASE_SCHEMA.md`)

2. **åç«¯ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–**ï¼š
   - **å®šé¢åˆ›å»ºé€»è¾‘ (`create_quota`)**ï¼š
     - å½“åˆ›å»ºæ–°å®šé¢æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾ç›¸åŒç»„åˆï¼ˆå·¥åºç¼–ç ã€å·¥æ®µç¼–ç ã€å·¥åºç±»åˆ«ç¼–ç ã€ç”µæœºå‹å·ï¼‰ä¸”ä½œåºŸæ—¥æœŸä¸º `9999-12-31` çš„ç°æœ‰å®šé¢
     - å¦‚æœæ‰¾åˆ°ï¼Œå°†ç°æœ‰å®šé¢çš„ä½œåºŸæ—¥æœŸæ›´æ–°ä¸ºæ–°å®šé¢ç”Ÿæ•ˆæ—¥æœŸçš„å‰ä¸€å¤©
     - ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å®šé¢ç»„åˆ
     - è®°å½•è­¦å‘Šæ—¥å¿—ä»¥ä¾¿è·Ÿè¸ªå®šé¢æ›´æ–°å†å²
   
   - **å·¥ä½œè®°å½•éªŒè¯é€»è¾‘ (`create_work_record`)**ï¼š
     - åˆ›å»ºå·¥ä½œè®°å½•æ—¶ï¼ŒéªŒè¯å·¥ä½œè®°å½•æ—¥æœŸæ˜¯å¦åœ¨å®šé¢çš„æœ‰æ•ˆæœŸå†…ï¼ˆç”Ÿæ•ˆæ—¥æœŸ â‰¤ å·¥ä½œè®°å½•æ—¥æœŸ â‰¤ ä½œåºŸæ—¥æœŸï¼‰
     - å¦‚æœæ—¥æœŸæ—©äºå®šé¢ç”Ÿæ•ˆæ—¥æœŸæˆ–æ™šäºä½œåºŸæ—¥æœŸï¼ŒæŠ›å‡º `ValueError` å¹¶é˜»æ­¢è®°å½•åˆ›å»º
     - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ä¾¿äºè°ƒè¯•å’Œç”¨æˆ·åé¦ˆ

3. **å‰ç«¯æ›´æ–°**ï¼š
   - æ›´æ–°å®šé¢ç®¡ç†é¡µé¢ (`frontend/src/pages/QuotaManagement.jsx`) æ˜¾ç¤ºä½œåºŸæ—¥æœŸå­—æ®µ
   - æ›´æ–°TypeScriptç±»å‹å®šä¹‰ (`frontend/src/types/index.ts`) åŒ…å«æ–°å­—æ®µ

4. **æµ‹è¯•éªŒè¯**ï¼š
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ (`test/development/99_overall_test.sh`) éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
   - æ‰€æœ‰APIæµ‹è¯•ã€å‰ç«¯æµ‹è¯•å’ŒPuppeteeræµ‹è¯•é€šè¿‡

### TypeScriptè¿ç§»ä¸å‰ç«¯ä¼˜åŒ– (2025-12-24)
1. **TypeScriptè¿ç§»å®Œæˆ**ï¼šå‰ç«¯æ ¸å¿ƒåŸºç¡€è®¾æ–½å·²è¿ç§»åˆ°TypeScript
   - æ ¸å¿ƒæ–‡ä»¶è¿ç§»ï¼š`App.tsx`, `Layout.tsx`, `Login.tsx`, `api.ts`, `main.tsx`
   - åˆ é™¤JavaScripté‡å¤æ–‡ä»¶ï¼š`App.jsx`, `Layout.jsx`, `Login.jsx`, `api.js`, `main.jsx`
   - èœå•ç»“æ„ä¼˜åŒ–ï¼šé‡æ–°æ’åºä¾§è¾¹æ èœå•é¡¹ï¼Œ"å·¥åºç®¡ç†"ç°åœ¨ä½äº"å·¥åºç±»åˆ«"ä¹‹å

2. **å‰ç«¯æ¶æ„ä¼˜åŒ–**ï¼š
   - ç»Ÿä¸€ä½¿ç”¨TypeScriptä½œä¸ºå…¥å£ç‚¹ (`main.tsx`)
   - ä¿ç•™JavaScripté¡µé¢ç»„ä»¶ç”¨äºæ¸è¿›å¼è¿ç§»
   - ä¿®å¤TypeScriptç¼–è¯‘è­¦å‘Šï¼ˆæœªä½¿ç”¨çš„å¯¼å…¥ç­‰ï¼‰

3. **èœå•ç»“æ„è°ƒæ•´**ï¼š
   - å·¥äººç®¡ç† â†’ å‹å·ç®¡ç† â†’ å·¥æ®µç±»åˆ«ç®¡ç† â†’ å·¥åºç±»åˆ«ç®¡ç† â†’ å·¥åºç®¡ç† â†’ å®šé¢ç®¡ç† â†’ å·¥èµ„è®°å½• â†’ æŠ¥è¡¨ç»Ÿè®¡
   - ç¬¦åˆä¸šåŠ¡é€»è¾‘æµç¨‹ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

### HTTPSéƒ¨ç½²ä¸äº‘æœåŠ¡å™¨é…ç½® (2025-12-05)
1. **HTTPSéƒ¨ç½²å®Œæˆ**ï¼šæˆåŠŸåœ¨äº‘æœåŠ¡å™¨ `49.235.120.195` ä¸Šå®ŒæˆHTTPSéƒ¨ç½²
   - ç”Ÿæˆè‡ªç­¾åSSLè¯ä¹¦
   - é…ç½®Nginxåå‘ä»£ç†æ”¯æŒHTTPS
   - å®ç°HTTPåˆ°HTTPSè‡ªåŠ¨é‡å®šå‘
   - æ–°å¢ `nginx-https-production.conf` é…ç½®æ–‡ä»¶

2. **SSHå…å¯†ç™»å½•é…ç½®**ï¼šä¸ºäº‘æœåŠ¡å™¨é…ç½®SSHå¯†é’¥ï¼Œå®ç°Gitå…å¯†æ“ä½œ
   - ç”ŸæˆSSHå¯†é’¥å¯¹
   - é…ç½®SSHå…å¯†ç™»å½•åˆ°Gitee
   - æ”¯æŒäº‘æœåŠ¡å™¨è‡ªåŠ¨æ‹‰å–ä»£ç æ›´æ–°

3. **éƒ¨ç½²æµç¨‹ä¼˜åŒ–**ï¼š
   - åˆ›å»ºæ ‡å‡†åŒ–HTTPSéƒ¨ç½²æµç¨‹æ–‡æ¡£ (`HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md`)
   - ä¼˜åŒ–Dockerå®¹å™¨éƒ¨ç½²è„šæœ¬
   - æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ (`test_https_puppeteer.js`)

4. **ç³»ç»ŸéªŒè¯**ï¼š
   - é€šè¿‡Puppeteerè‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯HTTPSç™»å½•åŠŸèƒ½
   - æµ‹è¯•APIæ¥å£åœ¨HTTPSç¯å¢ƒä¸‹çš„æ­£å¸¸å·¥ä½œ
   - éªŒè¯å‰ç«¯èµ„æºæ­£ç¡®åŠ è½½

### å¯†ç é‡ç½®ä¸ç³»ç»Ÿä¼˜åŒ– (2025-12-04)
1. **å¯†ç é‡ç½®**ï¼šé‡ç½®äº†ä¸‰ä¸ªå…³é”®ç”¨æˆ·çš„å¯†ç ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨ï¼š
   - `root` â†’ `root123`
   - `test` â†’ `test123`
   - `stat` â†’ `start`

2. **å‰ç«¯é…ç½®ä¼˜åŒ–**ï¼š
   - æ›´æ–°äº†å‰ç«¯ç¯å¢ƒå˜é‡ (`frontend/.env`)ï¼Œå°†APIåŸºç¡€URLä» `http://localhost:8001/api` æ”¹ä¸ºç›¸å¯¹è·¯å¾„ `/api`ï¼Œä½¿å‰ç«¯åœ¨Dockerå®¹å™¨ä¸­èƒ½æ­£ç¡®è®¿é—®åç«¯APIã€‚
   - é‡æ–°æ„å»ºäº†å‰ç«¯é™æ€æ–‡ä»¶å¹¶æ›´æ–°äº†Dockeré•œåƒã€‚

3. **Dockerå®¹å™¨ç¨³å®šæ€§**ï¼š
   - ä¿®å¤äº†Dockerå®¹å™¨å¼‚å¸¸é€€å‡ºé—®é¢˜ï¼Œç¡®ä¿å®¹å™¨å¥åº·è¿è¡Œã€‚
   - æ›´æ–°äº†Docker Composeé…ç½®ï¼Œç¡®ä¿å‰ç«¯å’Œåç«¯æœåŠ¡æ­£å¸¸åä½œã€‚

4. **æµ‹è¯•è„šæœ¬æ¸…ç†**ï¼š
   - ç§»é™¤äº†ä¸´æ—¶æµ‹è¯•è„šæœ¬ (`fix_password.py`, `reset_passwords.py`, `test_new_passwords.py` ç­‰)ã€‚
   - ä¿ç•™äº†æ ¼å¼åŒ–çš„æµ‹è¯•è„šæœ¬åœ¨ `test/` ç›®å½•ä¸­ã€‚

5. **ç³»ç»ŸéªŒè¯**ï¼š
   - éªŒè¯äº†æ‰€æœ‰ç”¨æˆ·çš„æ–°å¯†ç ç™»å½•åŠŸèƒ½ã€‚
   - ç¡®è®¤äº†ç»Ÿè®¡å‘˜ (`stat`) èƒ½å¤Ÿæ­£å¸¸è®¿é—®ç»Ÿè®¡APIã€‚
   - æµ‹è¯•äº†Dockerå®¹å™¨è¿è¡ŒçŠ¶æ€å’ŒAPIå¥åº·æ£€æŸ¥ã€‚

### ä½¿ç”¨è¯´æ˜æ›´æ–°
- ç³»ç»Ÿç°åœ¨å¯é€šè¿‡HTTPSè®¿é—®ï¼š`https://49.235.120.195`
- HTTPè¯·æ±‚è‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
- ç™»å½•æ—¶å¦‚é‡é—®é¢˜ï¼Œè¯·å°è¯•æµè§ˆå™¨ç¡¬åˆ·æ–° (Ctrl+F5) ä»¥æ¸…é™¤ç¼“å­˜ã€‚

## å¾…åŠäº‹é¡¹ (TODO)

### TypeScriptè¿ç§» - ç¬¬äºŒé˜¶æ®µ (æœªæ¥è®¡åˆ’)
å½“å‰å‰ç«¯é‡‡ç”¨æ··åˆæ¶æ„ï¼ˆTypeScriptæ ¸å¿ƒ + JavaScripté¡µé¢ç»„ä»¶ï¼‰ã€‚ä»¥ä¸‹æ˜¯æœªæ¥è¿ç§»è®¡åˆ’ï¼š

#### å·²å®Œæˆè¿ç§» (Phase 1 & 2)
- âœ… **æ ¸å¿ƒåŸºç¡€è®¾æ–½**: `App.tsx`, `Layout.tsx`, `Login.tsx`, `api.ts`, `main.tsx`
- âœ… **èœå•ä¼˜åŒ–**: é‡æ–°æ’åºä¾§è¾¹æ èœå•ï¼Œ"å·¥åºç®¡ç†"ä½äº"å·¥åºç±»åˆ«"ä¹‹å
- âœ… **æ„å»ºéªŒè¯**: TypeScriptç¼–è¯‘é€šè¿‡ï¼Œä»…å­˜åœ¨é¢„æœŸçš„ç±»å‹è­¦å‘Š

#### å¾…è¿ç§»é¡µé¢ (9ä¸ªJavaScriptæ–‡ä»¶)
1. `Home.jsx` - é¦–é¡µ/ç»Ÿè®¡é¢æ¿
2. `UserManagement.jsx` - ç”¨æˆ·ç®¡ç†é¡µé¢
3. `WorkerManagement.jsx` - å·¥äººç®¡ç†é¡µé¢
4. `ProcessManagement.jsx` - å·¥åºç®¡ç†é¡µé¢
5. `ProcessCat1Management.jsx` - å·¥æ®µç±»åˆ«ç®¡ç†
6. `ProcessCat2Management.jsx` - å·¥åºç±»åˆ«ç®¡ç†
7. `MotorModelManagement.jsx` - ç”µæœºå‹å·ç®¡ç†
8. `QuotaManagement.jsx` - å®šé¢ç®¡ç†é¡µé¢
9. `Report.jsx` - æŠ¥è¡¨ç»Ÿè®¡é¡µé¢

> æ³¨ï¼š`SalaryRecord.jsx` å·²æˆåŠŸè¿ç§»åˆ° TypeScript (`SalaryRecord.tsx`)

#### è¿ç§»é£é™©è¯„ä¼°
- **å½“å‰çŠ¶æ€**: ç¨³å®šï¼ŒåŠŸèƒ½æ­£å¸¸ï¼Œæ··åˆæ¶æ„å¯æ¥å—
- **é£é™©ç­‰çº§**: ä½åˆ°ä¸­ç­‰ï¼ˆç±»å‹å®‰å…¨ç¼ºå£ï¼Œä½†è¿è¡Œæ—¶åŠŸèƒ½æ­£å¸¸ï¼‰
- **å»ºè®®**: æŒ‰é¡µé¢ä½¿ç”¨é¢‘ç‡å’Œå¤æ‚åº¦é€æ­¥è¿ç§»

#### è¿ç§»æ­¥éª¤ (æœªæ¥æ‰§è¡Œ)
1. **å‡†å¤‡é˜¶æ®µ**: æ£€æŸ¥`types/index.ts`ç±»å‹å®šä¹‰å®Œæ•´æ€§
2. **è¿ç§»æ‰§è¡Œ**: é€ä¸ªé¡µé¢è½¬æ¢ä¸º`.tsx`ï¼Œæ·»åŠ ç±»å‹æ³¨è§£
3. **æµ‹è¯•éªŒè¯**: æ¯ä¸ªé¡µé¢è¿ç§»åæ‰‹åŠ¨æµ‹è¯•åŠŸèƒ½
4. **æ¸…ç†é˜¶æ®µ**: åˆ é™¤åŸå§‹`.jsx`æ–‡ä»¶ï¼Œæ›´æ–°å¯¼å…¥

#### ä¼˜å…ˆçº§å»ºè®®
1. **é«˜ä¼˜å…ˆçº§**: `UserManagement.jsx`, `WorkerManagement.jsx`ï¼ˆé¢‘ç¹ä½¿ç”¨ï¼‰
2. **ä¸­ä¼˜å…ˆçº§**: `ProcessManagement.jsx`, `QuotaManagement.jsx`ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰
3. **ä½ä¼˜å…ˆçº§**: å…¶ä»–ç¨³å®šé¡µé¢

## æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: FastAPI
- **æ•°æ®åº“**: MySQLï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ `MYSQL_DB_URL` é…ç½®ï¼‰
- **ORM**: SQLAlchemy
- **è®¤è¯**: JWT
- **ä¾èµ–ç®¡ç†**: pip

### å‰ç«¯
- **æ¡†æ¶**: React 19
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶åº“**: Ant Design 6
- **è·¯ç”±**: React Router 7
- **HTTPå®¢æˆ·ç«¯**: Axios

## é¡¹ç›®ç»“æ„

```
new_payroll/
â”œâ”€â”€ backend/                 # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app/                # FastAPIåº”ç”¨
â”‚   â”‚   â”œâ”€â”€ api/            # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py     # è®¤è¯ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ user.py     # ç”¨æˆ·ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ worker.py   # å·¥äººç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ process.py  # å·¥åºç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ process_cat1.py  # å·¥æ®µç±»åˆ«API
â”‚   â”‚   â”‚   â”œâ”€â”€ process_cat2.py  # å·¥åºç±»åˆ«API
â”‚   â”‚   â”‚   â”œâ”€â”€ motor_model.py   # ç”µæœºå‹å·API
â”‚   â”‚   â”‚   â”œâ”€â”€ quota.py    # å®šé¢ç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ salary.py   # å·¥èµ„è®°å½•API
â”‚   â”‚   â”‚   â”œâ”€â”€ report.py   # æŠ¥è¡¨API
â”‚   â”‚   â”‚   â””â”€â”€ stats.py    # ç»Ÿè®¡API
â”‚   â”‚   â”œâ”€â”€ models.py       # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ schemas.py      # Pydanticæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ database.py     # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ crud.py         # CRUDæ“ä½œ
â”‚   â”‚   â””â”€â”€ main.py         # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
â”‚   â”œâ”€â”€ run.py              # è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ scripts/            # å·¥å…·è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init_db.py          # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ generate_test_data.py # æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ check_routes.py     # è·¯ç”±æ£€æŸ¥è„šæœ¬
â”‚   â”‚   â””â”€â”€ query_quota_records.py # å®šé¢è®°å½•æŸ¥è¯¢è„šæœ¬
â”‚   â””â”€â”€ payroll.db          # æ•°æ®åº“æ–‡ä»¶ï¼ˆä½¿ç”¨MySQLï¼Œæ— éœ€æœ¬åœ°æ–‡ä»¶ï¼‰
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/               # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ components/    # Reactç»„ä»¶ (Layout.tsx)
â”‚   â”‚   â”œâ”€â”€ pages/         # é¡µé¢ç»„ä»¶ (æ··åˆ: .jsx + .tsx)
â”‚   â”‚   â”œâ”€â”€ services/      # APIæœåŠ¡ (api.ts)
â”‚   â”‚   â”œâ”€â”€ types/         # TypeScriptç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ App.tsx        # åº”ç”¨ç»„ä»¶ (TypeScript)
â”‚   â”‚   â””â”€â”€ main.tsx       # åº”ç”¨å…¥å£ (TypeScript)
â”‚   â”œâ”€â”€ package.json       # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json      # TypeScripté…ç½®
â”‚   â””â”€â”€ vite.config.js     # Viteé…ç½®
â”œâ”€â”€ test/                  # æµ‹è¯•è„šæœ¬å’Œèµ„æº
â”‚   â”œâ”€â”€ development/       # å¼€å‘æµ‹è¯•è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ test_api.py        # APIæµ‹è¯•è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ test_login.js      # å‰ç«¯ç™»å½•æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_user_management.js  # ç”¨æˆ·ç®¡ç†æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_worker_process_operations.js  # å·¥äººå·¥åºæ“ä½œæµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_new_tables.js  # æ–°è¡¨æµ‹è¯•
â”‚   â”œâ”€â”€ docker_puppeteer/  # Docker Puppeteeræµ‹è¯•
â”‚   â””â”€â”€ *.png              # æµ‹è¯•æˆªå›¾
â”œâ”€â”€ Dockerfile             # Dockeré…ç½®
â”œâ”€â”€ nginx-https-production.conf # ç”Ÿäº§ç¯å¢ƒHTTPS Nginxé…ç½®
â”œâ”€â”€ docker-compose-local.yml    # æœ¬åœ°Docker Composeé…ç½®
â”œâ”€â”€ docker-compose-tencent.yml  # è…¾è®¯äº‘Docker Composeé…ç½®
â”œâ”€â”€ docker-compose-tencent_test.yml # è…¾è®¯äº‘æµ‹è¯•ç¯å¢ƒDocker Composeé…ç½®
â”œâ”€â”€ HTTPS_DEPLOYMENT_GUIDE.md # HTTPSéƒ¨ç½²æŒ‡å—
â”œâ”€â”€ HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md # HTTPSéƒ¨ç½²åˆ†æä¸æµç¨‹æ–‡æ¡£ï¼ˆæœ€æ–°ï¼‰
â”œâ”€â”€ SSH_Password_Less_Login_Guide.md # SSHå…å¯†ç™»å½•æŒ‡å—
â”œâ”€â”€ generate_ssl_cert.sh   # SSLè¯ä¹¦ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ fix_password_hash.py   # å¯†ç å“ˆå¸Œä¿®å¤è„šæœ¬
â”œâ”€â”€ test_https_puppeteer.js # HTTPSè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
â”œâ”€â”€ docker_local.sh        # æœ¬åœ°Dockerå¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_services.sh      # æœåŠ¡å¯åŠ¨è„šæœ¬
â”œâ”€â”€ run_all_tests_docker.sh # Dockeræµ‹è¯•è„šæœ¬
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## åŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¿®æ”¹å¯†ç 
- è§’è‰²æƒé™ç®¡ç†ï¼ˆç®¡ç†å‘˜ã€ç»Ÿè®¡å‘˜ã€æŠ¥è¡¨æŸ¥çœ‹å‘˜ï¼‰
- ç”¨æˆ·ä¿¡æ¯ç»´æŠ¤
- æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•éœ€ä¿®æ”¹å¯†ç ï¼ˆneed_change_passwordæœºåˆ¶ï¼‰

### 2. å·¥äººç®¡ç†
- å·¥äººä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥
- å·¥å·ç®¡ç†

### 3. å·¥æ®µç±»åˆ«ç®¡ç†
- å·¥æ®µåˆ†ç±»ä¿¡æ¯ç»´æŠ¤ï¼ˆå¦‚ï¼šç²¾åŠ å·¥ã€è£…é…å–·æ¼†ã€ç»•åµŒæ’ç­‰ï¼‰
- å·¥æ®µç¼–ç å’Œåç§°ç®¡ç†

### 4. å·¥åºç±»åˆ«ç®¡ç†
- å·¥åºåˆ†ç±»ä¿¡æ¯ç»´æŠ¤
- å·¥åºç±»åˆ«ç¼–ç å’Œåç§°ç®¡ç†

### 5. ç”µæœºå‹å·ç®¡ç†
- ç”µæœºå‹å·ä¿¡æ¯ç»´æŠ¤
- ç”µæœºå‹å·åç§°å’Œåˆ«åç®¡ç†

### 6. å·¥åºç®¡ç†
- å·¥åºä¿¡æ¯ç»´æŠ¤
- å·¥åºç¼–ç ã€åç§°å’Œæè¿°ç®¡ç†

### 7. å®šé¢ç®¡ç†
- å·¥åºå®šé¢è®¾ç½®ï¼ˆå…³è”å·¥åºã€å·¥æ®µã€å·¥åºç±»åˆ«ã€ç”µæœºå‹å·ï¼‰
- å•ä»·å’Œç”Ÿæ•ˆæ—¥æœŸç®¡ç†
- å®šé¢å†å²è®°å½•

### 8. å·¥èµ„è®°å½•
- å·¥äººå·¥ä½œè®°å½•å½•å…¥ï¼ˆæ•°é‡ã€æ—¥æœŸï¼‰
- å·¥èµ„è‡ªåŠ¨è®¡ç®—ï¼ˆæ•°é‡ Ã— å•ä»·ï¼‰
- æŒ‰æ—¥æœŸç»Ÿè®¡å’ŒæŸ¥è¯¢

### 9. æŠ¥è¡¨åŠŸèƒ½
- å·¥äººå·¥èµ„æŠ¥è¡¨ç”Ÿæˆ
- å·¥åºå·¥ä½œé‡æŠ¥è¡¨
- å·¥èµ„æ±‡æ€»æŠ¥è¡¨
- æ•°æ®å¯¼å‡ºåŠŸèƒ½

### 10. ç»Ÿè®¡åŠŸèƒ½
- ç³»ç»Ÿæ•°æ®ç»Ÿè®¡ï¼ˆç”¨æˆ·æ•°ã€å·¥äººæ•°ã€å·¥åºæ•°ç­‰ï¼‰
- å·¥åºå®šé¢ç»Ÿè®¡
- å·¥äººå·¥èµ„ç»Ÿè®¡
- ç”Ÿäº§æ•ˆç‡åˆ†æ

## å®‰å…¨é…ç½®

### ğŸ” æ•°æ®åº“å‡­è¯å®‰å…¨æœ€ä½³å®è·µ

ç³»ç»Ÿå·²å®ç°å®‰å…¨çš„æ•°æ®åº“å‡­è¯ç®¡ç†ï¼Œéµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š

1. **ç³»ç»Ÿç¯å¢ƒå˜é‡**ï¼šæ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œä¸ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
2. **ç¯å¢ƒå˜é‡æ–‡ä»¶**ï¼šä½¿ç”¨ `~/shared/jianglei/payroll/env_local.sh` é›†ä¸­ç®¡ç†ç¯å¢ƒå˜é‡
3. **Gitå¿½ç•¥**ï¼š`.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²
4. **Dockerå®‰å…¨**ï¼šDockerå®¹å™¨æ”¯æŒè¿è¡Œæ—¶ç¯å¢ƒå˜é‡æ³¨å…¥

### ç¯å¢ƒå˜é‡é…ç½®

ç³»ç»Ÿä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ï¼Œä¸å†ä¾èµ– `.env` æ–‡ä»¶ã€‚

#### è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¿…éœ€ï¼‰
åœ¨å¯åŠ¨åº”ç”¨ä¹‹å‰ï¼Œå¿…é¡»å…ˆè®¾ç½®ç¯å¢ƒå˜é‡ã€‚

**æœ¬åœ°å¼€å‘ï¼š**
```bash
source ~/shared/jianglei/payroll/env_local.sh
```

**äº‘æœåŠ¡å™¨éƒ¨ç½²ï¼š**
```bash
source ~/shared/jianglei/payroll/env_cloud.sh
```

**æ³¨æ„**ï¼šæ¯æ¬¡æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£éƒ½éœ€è¦é‡æ–°æ‰§è¡Œæ­¤å‘½ä»¤ã€‚

#### å¿…éœ€çš„ç¯å¢ƒå˜é‡
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²åœ¨ç³»ç»Ÿä¸­è®¾ç½®ï¼š

**åç«¯å˜é‡ï¼š**
- `MYSQL_DB_URL` - MySQLæ•°æ®åº“è¿æ¥URL
- `SECRET_KEY` - JWTå¯†é’¥
- `ALGORITHM` - JWTç®—æ³•ï¼ˆé»˜è®¤ï¼šHS256ï¼‰
- `ACCESS_TOKEN_EXPIRE_MINUTES` - Tokenè¿‡æœŸæ—¶é—´ï¼ˆé»˜è®¤ï¼š30ï¼‰

**å‰ç«¯å˜é‡ï¼ˆVITE_*ï¼‰ï¼š**
- `VITE_API_BASE_URL` - å‰ç«¯APIåŸºç¡€URLï¼ˆå¼€å‘ï¼š`/api`ï¼Œç”Ÿäº§ï¼š`https://49.235.120.195/api`ï¼‰
- `VITE_APP_ENV` - åº”ç”¨ç¯å¢ƒï¼ˆå¼€å‘ï¼š`development`ï¼Œç”Ÿäº§ï¼š`production`ï¼‰
- `VITE_ENABLE_HTTPS` - æ˜¯å¦å¯ç”¨HTTPSï¼ˆä»…ç”Ÿäº§ç¯å¢ƒï¼‰

#### Dockerç¯å¢ƒå˜é‡
è¿è¡ŒDockerå®¹å™¨æ—¶ä¼ é€’ç¯å¢ƒå˜é‡ï¼š
```bash
docker run -d -p 8000:8000 \
  -e MYSQL_DB_URL="mysql+pymysql://username:password@host:port/database" \
  -e SECRET_KEY="your-secret-key" \
  payroll-system
```

### éªŒè¯ç¯å¢ƒé…ç½®
è¿è¡Œåº”ç”¨å‰ï¼Œè¯·ç¡®ä¿ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®ï¼š
```bash
echo $MYSQL_DB_URL
echo $SECRET_KEY
```
å¦‚æœä»¥ä¸Šå‘½ä»¤è¿”å›ç©ºå€¼ï¼Œè¯·å…ˆæ‰§è¡Œ `source ~/shared/jianglei/payroll/env_local.sh`ã€‚

## å®‰è£…ä¸è¿è¡Œ

### åç«¯å®‰è£…

1. è¿›å…¥åç«¯ç›®å½•
```bash
cd backend
```

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
python -m venv venv
```

3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
```bash
# Windows
env\Scripts\activate

# Linux/macOS
source venv/bin/activate
```

4. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

5. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¿…éœ€ï¼‰
```bash
source ~/shared/jianglei/payroll/env_local.sh
```

6. åˆå§‹åŒ–æ•°æ®åº“
```bash
python scripts/init_db.py
```

7. è¿è¡Œåç«¯æœåŠ¡
```bash
python run.py
```

åç«¯æœåŠ¡å°†åœ¨ http://localhost:8000 å¯åŠ¨

### å‰ç«¯å®‰è£…

1. è¿›å…¥å‰ç«¯ç›®å½•
```bash
cd frontend
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. å¼€å‘æ¨¡å¼è¿è¡Œ
```bash
npm run dev
```

å‰ç«¯å¼€å‘æœåŠ¡å°†åœ¨ http://localhost:5173 å¯åŠ¨

4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
```bash
npm run build
```

æ„å»ºåçš„æ–‡ä»¶å°†ç”Ÿæˆåœ¨ `dist` ç›®å½•ä¸‹

## APIæ–‡æ¡£

åç«¯æä¾›äº†å®Œæ•´çš„APIæ–‡æ¡£ï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹ï¼š

- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## æ•°æ®åº“ç»“æ„

### ä¸»è¦è¡¨ç»“æ„

1. **users** - ç”¨æˆ·è¡¨
   - id: ç”¨æˆ·ID
   - username: ç”¨æˆ·å
   - password: å¯†ç 
   - name: çœŸå®å§“å
   - role: è§’è‰²ï¼ˆadmin/statistician/reportï¼‰
   - created_at: åˆ›å»ºæ—¶é—´

2. **workers** - å·¥äººè¡¨
   - worker_code: å·¥å·
   - name: å§“å
   - created_at: åˆ›å»ºæ—¶é—´

3. **processes** - å·¥åºè¡¨
   - process_code: å·¥åºç¼–ç 
   - name: å·¥åºåç§°
   - description: æè¿°
   - created_at: åˆ›å»ºæ—¶é—´

4. **process_cat1** - å·¥æ®µç±»åˆ«è¡¨
   - cat1_code: å·¥æ®µç¼–ç 
   - name: å·¥æ®µåç§°
   - description: å·¥æ®µæè¿°
   - created_at: åˆ›å»ºæ—¶é—´

5. **process_cat2** - å·¥åºç±»åˆ«è¡¨
   - cat2_code: å·¥åºç±»åˆ«ç¼–ç 
   - name: å·¥åºç±»åˆ«åç§°
   - description: å·¥åºç±»åˆ«æè¿°
   - created_at: åˆ›å»ºæ—¶é—´

6. **motor_models** - ç”µæœºå‹å·è¡¨
   - name: ç”µæœºå‹å·åç§°
   - aliases: ç”µæœºå‹å·åˆ«å
   - description: ç”µæœºå‹å·æè¿°
   - created_at: åˆ›å»ºæ—¶é—´

7. **quotas** - å®šé¢è¡¨
   - id: å®šé¢ID
   - process_code: å·¥åºç¼–ç 
   - cat1_code: å·¥æ®µç¼–ç 
   - cat2_code: å·¥åºç±»åˆ«ç¼–ç 
   - model_name: ç”µæœºå‹å·åç§°
   - unit_price: å•ä»·
   - effective_date: ç”Ÿæ•ˆæ—¥æœŸ
   - obsolete_date: ä½œåºŸæ—¥æœŸï¼ˆé»˜è®¤å€¼ï¼š9999-12-31ï¼Œè¡¨ç¤ºå½“å‰æœ‰æ•ˆå®šé¢ï¼‰
   - created_by: åˆ›å»ºäºº
   - created_at: åˆ›å»ºæ—¶é—´

8. **work_records** - å·¥ä½œè®°å½•è¡¨
   - id: è®°å½•ID
   - worker_code: å·¥å·
   - quota_id: å®šé¢ID
   - quantity: æ•°é‡
   - record_date: è®°å½•æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
   - created_by: åˆ›å»ºäºº
   - created_at: åˆ›å»ºæ—¶é—´

9. **v_salary_records** - å·¥èµ„è®°å½•è§†å›¾
   - id: è®°å½•ID
   - worker_code: å·¥å·
   - quota_id: å®šé¢ID
   - quantity: æ•°é‡
   - unit_price: å•ä»·
   - amount: é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼šquantity Ã— unit_priceï¼‰
   - record_date: è®°å½•æ—¥æœŸ
   - created_by: åˆ›å»ºäºº
   - created_at: åˆ›å»ºæ—¶é—´
   - model_display: ç”µæœºå‹å·æ˜¾ç¤º
   - cat1_display: å·¥æ®µç±»åˆ«æ˜¾ç¤º
   - cat2_display: å·¥åºç±»åˆ«æ˜¾ç¤º
   - process_display: å·¥åºæ˜¾ç¤º

## ä½¿ç”¨è¯´æ˜

1. **ç™»å½•ç³»ç»Ÿ**
   - è®¿é—® http://localhost:8000
   - ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•ï¼ˆåˆå§‹è´¦å·å¯åœ¨ä»£ç ä¸­é…ç½®ï¼‰
   - æ–°ç”¨æˆ·é¦–æ¬¡ç™»å½•ä¼šæç¤ºä¿®æ”¹å¯†ç 

2. **åŸºç¡€æ•°æ®ç»´æŠ¤**
   - é¦–å…ˆæ·»åŠ å·¥åºä¿¡æ¯
   - ç„¶åè®¾ç½®å„å·¥åºçš„å®šé¢
   - æ·»åŠ å·¥äººä¿¡æ¯

3. **å·¥èµ„ç®¡ç†**
   - æ¯æœˆå½•å…¥å·¥äººçš„ç”Ÿäº§æ•°é‡
   - ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—å·¥èµ„
   - ç”Ÿæˆå·¥èµ„æŠ¥è¡¨

4. **æŠ¥è¡¨ç»Ÿè®¡**
   - æŸ¥çœ‹å·¥èµ„ç»Ÿè®¡æŠ¥è¡¨
   - åˆ†æç”Ÿäº§æ•ˆç‡
   - å¯¼å‡ºæ•°æ®

è¯¦ç»†ä½¿ç”¨è¯´æ˜è¯·å‚è€ƒ [ç”¨æˆ·æ‰‹å†Œ.md](ç”¨æˆ·æ‰‹å†Œ.md)

## å¼€å‘è¯´æ˜

### åç«¯å¼€å‘

- æ–°å¢APIè·¯ç”±ï¼šåœ¨ `backend/app/api/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
- æ–°å¢æ•°æ®æ¨¡å‹ï¼šåœ¨ `backend/app/models.py` ä¸­å®šä¹‰
- æ–°å¢æ•°æ®æ ¡éªŒï¼šåœ¨ `backend/app/schemas.py` ä¸­å®šä¹‰
- æ–°å¢CRUDæ“ä½œï¼šåœ¨ `backend/app/crud.py` ä¸­å®ç°
- **é‡æ„æ€»ç»“**ï¼šå‚è€ƒ [`backend/BACKEND_REFACTORING_SUMMARY.md`](backend/BACKEND_REFACTORING_SUMMARY.md) äº†è§£åç«¯æ¶æ„é‡æ„è¯¦æƒ…

### å‰ç«¯å¼€å‘

- **TypeScriptæ¶æ„**ï¼šæ ¸å¿ƒåŸºç¡€è®¾æ–½ä½¿ç”¨TypeScript (`App.tsx`, `Layout.tsx`, `Login.tsx`, `api.ts`)
- **æ··åˆé¡µé¢**ï¼šé¡µé¢ç»„ä»¶é‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥ï¼ˆå½“å‰ä¸ºJavaScriptï¼Œæœªæ¥è¿ç§»åˆ°TypeScriptï¼‰
- **æ–°å¢é¡µé¢**ï¼šåœ¨ `frontend/src/pages/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„é¡µé¢ç»„ä»¶ï¼ˆå»ºè®®ä½¿ç”¨`.tsx`ï¼‰
- **æ–°å¢ç»„ä»¶**ï¼šåœ¨ `frontend/src/components/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ç»„ä»¶ï¼ˆå»ºè®®ä½¿ç”¨`.tsx`ï¼‰
- **APIè°ƒç”¨**ï¼šé€šè¿‡ `frontend/src/services/api.ts` å°è£…çš„APIæ–¹æ³•è°ƒç”¨åç«¯æ¥å£
- **ç±»å‹å®šä¹‰**ï¼šåœ¨ `frontend/src/types/` ç›®å½•ä¸‹ç»´æŠ¤TypeScriptç±»å‹å®šä¹‰
- **é‡æ„æ€»ç»“**ï¼šå‚è€ƒ [`frontend/TYPESCRIPT_REFACTORING_SUMMARY.md`](frontend/TYPESCRIPT_REFACTORING_SUMMARY.md) äº†è§£TypeScriptè¿ç§»è¯¦æƒ…

## éƒ¨ç½²

### å¿«é€Ÿéƒ¨ç½²åˆ°è…¾è®¯äº‘

ä½¿ç”¨ Docker Compose é…ç½®æ–‡ä»¶å¯ä»¥å¿«é€Ÿéƒ¨ç½²åˆ°è…¾è®¯äº‘æœåŠ¡å™¨ã€‚

```bash
# ä½¿ç”¨è…¾è®¯äº‘ç”Ÿäº§ç¯å¢ƒé…ç½®éƒ¨ç½²
docker-compose -f docker-compose-tencent.yml up -d

# æˆ–ä½¿ç”¨è…¾è®¯äº‘æµ‹è¯•ç¯å¢ƒé…ç½®
docker-compose -f docker-compose-tencent_test.yml up -d
```

**è®¿é—®åœ°å€ï¼š** https://49.235.120.195

**éƒ¨ç½²è„šæœ¬åŠŸèƒ½ï¼š**
- âœ… ä½¿ç”¨Docker Composeç®¡ç†å¤šå®¹å™¨éƒ¨ç½²
- âœ… æ”¯æŒæœ¬åœ°ã€æµ‹è¯•ã€ç”Ÿäº§å¤šç¯å¢ƒé…ç½®
- âœ… å‰ç«¯æ„å»ºå’Œåç«¯æœåŠ¡é›†æˆ
- âœ… MySQLæ•°æ®åº“é›†æˆ

**å¸¸ç”¨å‘½ä»¤ï¼š**
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose -f docker-compose-tencent.yml logs -f

# åœæ­¢/é‡å¯æœåŠ¡
docker-compose -f docker-compose-tencent.yml stop
docker-compose -f docker-compose-tencent.yml start

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker-compose -f docker-compose-tencent.yml ps
```

### æœåŠ¡å™¨é‡å¯å¤„ç†

æœåŠ¡å™¨é‡å¯åï¼ŒæœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨ï¼š

| æœåŠ¡ | å¯åŠ¨æ–¹å¼ | çŠ¶æ€ |
|------|---------|------|
| Dockerå®¹å™¨ | `--restart unless-stopped` | âœ… è‡ªåŠ¨å¯åŠ¨ |
| nginx | `systemctl enable nginx` | âœ… è‡ªåŠ¨å¯åŠ¨ |

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

1. å¯åŠ¨åç«¯æœåŠ¡
2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡
3. è®¿é—® http://localhost:5173

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. æ„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬
2. å¯åŠ¨åç«¯æœåŠ¡ï¼ˆå¯ä½¿ç”¨Gunicornç­‰WSGIæœåŠ¡å™¨ï¼‰
3. é…ç½®Nginxåå‘ä»£ç†
4. è®¿é—®ç”Ÿäº§æœåŠ¡å™¨åœ°å€

## Dockeréƒ¨ç½²

### æœ¬åœ°Dockeréƒ¨ç½²
1. æ„å»ºDockeré•œåƒ
```bash
docker build -t payroll-system .
```

2. è¿è¡ŒDockerå®¹å™¨
```bash
docker run -d -p 8000:8000 payroll-system
```

### äº‘æœåŠ¡å™¨éƒ¨ç½²
ç³»ç»Ÿå·²é…ç½®æ”¯æŒäº‘æœåŠ¡å™¨HTTPSéƒ¨ç½²ï¼Œè¯·å‚è€ƒæœ€æ–°çš„éƒ¨ç½²æ–‡æ¡£ã€‚

#### æ¨èéƒ¨ç½²æµç¨‹
å‚è€ƒ [HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md](document/HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md) æ–‡ä»¶ä¸­çš„"Robust HTTPS Deployment Procedure"ç« èŠ‚ï¼ŒåŒ…å«å®Œæ•´çš„å‡†å¤‡ã€æ•°æ®åº“å‡†å¤‡ã€Dockeréƒ¨ç½²ã€éªŒè¯å’Œå›æ»šæ­¥éª¤ã€‚

#### è¯¦ç»†éƒ¨ç½²æŒ‡å—
- **CLOUDBASE_RUN_DEPLOYMENT.md**: è…¾è®¯äº‘äº‘æ‰˜ç®¡éƒ¨ç½²æŒ‡å—
- **HTTPS_DEPLOYMENT_GUIDE.md**: HTTPSéƒ¨ç½²æŒ‡å—ï¼ˆå·²æ›´æ–°ï¼‰
- **HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md**: è¯¦ç»†çš„HTTPSéƒ¨ç½²åˆ†æä¸æµç¨‹æ–‡æ¡£ï¼ˆæœ€æ–°ï¼‰

#### å…³é”®æ–‡ä»¶
- `nginx-https-production.conf`: ç”Ÿäº§ç¯å¢ƒNginx HTTPSé…ç½®
- `generate_ssl_cert.sh`: SSLè¯ä¹¦ç”Ÿæˆè„šæœ¬
- `fix_password_hash.py`: å¯†ç å“ˆå¸Œä¿®å¤è„šæœ¬ï¼ˆå¦‚é‡ç™»å½•é—®é¢˜ï¼‰
- `test_https_puppeteer.js`: HTTPSè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆéƒ¨ç½²éªŒè¯ï¼‰

### Dockeréƒ¨ç½²æ¶æ„è¯´æ˜
ç³»ç»Ÿé‡‡ç”¨åŒå®¹å™¨æ¶æ„ï¼Œåˆ†åˆ«è¿è¡Œåç«¯åº”ç”¨å’ŒNginxåå‘ä»£ç†ï¼š

#### 1. åç«¯å®¹å™¨ (payroll-backend)
- **é•œåƒæ„å»º**ï¼šä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ `Dockerfile` æ„å»º
- **åŸºç¡€é•œåƒ**ï¼š`python:3.10`
- **åŒ…å«å†…å®¹**ï¼š
  - Pythonåç«¯åº”ç”¨ä»£ç 
  - å‰ç«¯æ„å»ºçš„é™æ€æ–‡ä»¶ (`frontend/dist/`)
  - ç³»ç»Ÿä¾èµ–å’ŒPythonåŒ…
- **è¿è¡Œå‘½ä»¤**ï¼š
  ```bash
  docker build -t payroll-backend -f Dockerfile .
  docker run -d --name payroll-backend -p 8000:8000 payroll-backend
  ```

#### 2. Nginxå®¹å™¨ (payroll-nginx)
- **é•œåƒæ¥æº**ï¼šç›´æ¥ä½¿ç”¨å®˜æ–¹ `nginx:alpine` é•œåƒï¼Œ**æ— éœ€è‡ªå®šä¹‰Dockerfile**
- **é…ç½®æ–¹å¼**ï¼šè¿è¡Œæ—¶æŒ‚è½½é…ç½®æ–‡ä»¶
- **åˆ›å»ºå‘½ä»¤**ï¼š
  ```bash
  docker run -d --name payroll-nginx \
    -p 80:80 -p 443:443 \
    -v /path/to/nginx-https-production.conf:/etc/nginx/conf.d/default.conf:ro \
    -v /path/to/ssl:/app/ssl:ro \
    -v /path/to/frontend-dist:/app/frontend/dist:ro \
    nginx:alpine
  ```

#### æ¶æ„ä¼˜åŠ¿
1. **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šåç«¯å’ŒNginxç‹¬ç«‹å®¹å™¨ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
2. **é…ç½®çµæ´»**ï¼šNginxé…ç½®å¯éšæ—¶ä¿®æ”¹ï¼Œæ— éœ€é‡æ–°æ„å»ºé•œåƒ
3. **è½»é‡çº§**ï¼šä½¿ç”¨Alpineé•œåƒï¼Œèµ„æºå ç”¨å°‘
4. **å®˜æ–¹ç»´æŠ¤**ï¼šNginxé•œåƒç”±Dockerå®˜æ–¹ç»´æŠ¤ï¼Œå®‰å…¨æ›´æ–°åŠæ—¶

#### å®¹å™¨é—´é€šä¿¡
```
ç”¨æˆ·è¯·æ±‚ â†’ Nginxå®¹å™¨ (80/443) â†’ åç«¯å®¹å™¨ (8000) â†’ æ•°æ®åº“
         â†‘                    â†‘
     SSLç»ˆæ­¢             åå‘ä»£ç†
```

#### é…ç½®æ–‡ä»¶è¯´æ˜
- `nginx-https-production.conf`ï¼šç”Ÿäº§ç¯å¢ƒHTTPSé…ç½®
  - HTTPè‡ªåŠ¨é‡å®šå‘åˆ°HTTPS
  - é™æ€æ–‡ä»¶æœåŠ¡ (`/app/frontend/dist`)
  - APIåå‘ä»£ç† (`/api/` â†’ `http://172.17.0.1:8000`)
  - SSLè¯ä¹¦é…ç½®

#### æ•°æ®æŒä¹…åŒ–
- **æ•°æ®åº“**ï¼šMySQLï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ `MYSQL_DB_URL` é…ç½®ï¼‰
- **é…ç½®æ–‡ä»¶**ï¼šNginxé…ç½®ã€SSLè¯ä¹¦ã€å‰ç«¯æ–‡ä»¶å‡é€šè¿‡å·æŒ‚è½½
- **ä¼˜åŠ¿**ï¼šæ•°æ®åœ¨å®¹å™¨é‡å¯åä¸ä¼šä¸¢å¤±ï¼Œé…ç½®å¯éšæ—¶æ›´æ–°

## æµ‹è¯•

é¡¹ç›®åŒ…å«æµ‹è¯•è„šæœ¬ï¼Œä½äº `test/` ç›®å½•ä¸‹ã€‚è¿è¡Œæµ‹è¯•ä»¥ç¡®ä¿åŠŸèƒ½æ­£å¸¸ï¼š

```bash
cd test/development
# è¿è¡ŒAPIæµ‹è¯•
python test_api.py
# è¿è¡Œå‰ç«¯æµ‹è¯•
node test_login.js
```

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘
```bash
# å…‹éš†ä»£ç 
git clone https://gitee.com/richardjl/payroll-system.git
cd payroll-system

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¿…éœ€ï¼‰
source ~/shared/jianglei/payroll/env_local.sh

# å¯åŠ¨åç«¯
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python run.py

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm install
npm run dev
```

### äº‘æœåŠ¡å™¨éƒ¨ç½²
è¯·å‚è€ƒæœ€æ–°çš„HTTPSéƒ¨ç½²æ–‡æ¡£ [HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md](HTTPS_DEPLOYMENT_ANALYSIS_AND_PROCEDURE.md) ä¸­çš„å®Œæ•´æ­¥éª¤ã€‚

ç®€è¦æ­¥éª¤ï¼š
```bash
# ç™»å½•äº‘æœåŠ¡å™¨
ssh jingying@49.235.120.195

# ä½¿ç”¨Docker Composeéƒ¨ç½²
cd /home/richard/shared/jianglei/trae/new_payroll
docker-compose -f docker-compose-tencent.yml up -d

# æˆ–ä½¿ç”¨æµ‹è¯•ç¯å¢ƒé…ç½®
docker-compose -f docker-compose-tencent_test.yml up -d
```

## æ³¨æ„äº‹é¡¹

1. åˆå§‹ç®¡ç†å‘˜è´¦å·éœ€è¦åœ¨ä»£ç ä¸­é…ç½®
2. ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ä¿®æ”¹CORSé…ç½®ï¼Œé™åˆ¶å…è®¸çš„åŸŸå
3. ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨MySQLæˆ–PostgreSQLæ•°æ®åº“
4. å®šæœŸå¤‡ä»½æ•°æ®åº“

## é¡¹ç›®è®¡åˆ’

é¡¹ç›®è®¡åˆ’æ–‡æ¡£ä½äº `plans/` ç›®å½•ä¸‹ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- `enhancement_plan.md` - ç³»ç»Ÿå¢å¼ºè®¡åˆ’
- `add_work_record_plan.md` - å·¥ä½œè®°å½•åŠŸèƒ½è®¡åˆ’
- `column_seq_implementation_plan.md` - å·¥åºåºå·å®ç°è®¡åˆ’
- `salary_management_redesign_plan.md` - å·¥èµ„ç®¡ç†é‡æ„è®¡åˆ’
- `way0_quota_selection_plan.md` - å®šé¢é€‰æ‹©æ–¹æ¡ˆè®¡åˆ’
- `cloud_run_deployment_plan.md` - äº‘æ‰˜ç®¡éƒ¨ç½²è®¡åˆ’

å¼€å‘æµç¨‹åŒ…å«ä»¥ä¸‹é˜¶æ®µï¼š

1. éœ€æ±‚åˆ†æå’Œç³»ç»Ÿè®¾è®¡
2. åŸºç¡€æ¡†æ¶æ­å»º
3. æ ¸å¿ƒåŠŸèƒ½å¼€å‘
4. æµ‹è¯•å’Œä¼˜åŒ–
5. éƒ¨ç½²ä¸Šçº¿

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿è”ç³»å¼€å‘å›¢é˜Ÿã€‚
